 {% extends 'base.html' %}

{% block title %}{{ finca.nombre }} - Finca - Ganadek{% endblock %}

{% block content %}
  <div class="max-w-4xl mx-auto">
            <!-- Breadcrumb -->
            <nav class="flex mb-6" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="#" class="text-gray-700 hover:text-green-600 inline-flex items-center">
                            <i class="fas fa-home w-4 h-4 mr-2"></i>
                            Inicio
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-400 w-4 h-4"></i>
                            <span class="ml-1 text-green-600 font-medium md:ml-2">Crear Nueva Finca</span>
                        </div>
                    </li>
                </ol>
            </nav>

            <!-- Form Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
                <!-- Card Header -->
                <div class="bg-gradient-to-r from-green-600 to-emerald-600 px-8 py-6">
                    <div class="flex items-center">
                        <i class="fas fa-plus-circle text-white text-3xl mr-4"></i>
                        <div>
                            <h2 class="text-2xl font-bold text-white">Crear Nueva Finca</h2>
                            <p class="text-green-100">Registra los datos de tu propiedad agrícola</p>
                        </div>
                    </div>
                </div>

                <!-- Form Body -->
                <form id="fincaForm" class="p-8">
                    <!-- Información Básica -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                            Información Básica
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Nombre -->
                            <div class="form-group">
                                <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-tag text-gray-400 mr-1"></i>
                                    Nombre de la Finca *
                                </label>
                                <input type="text" id="nombre" name="nombre" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                    placeholder="Ej: Finca El Paraíso">
                                <div class="error-message hidden text-red-500 text-sm mt-1"></div>
                            </div>

                            <!-- Propietario -->
                            <div class="form-group">
                                <label for="cedulapropietario" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-user text-gray-400 mr-1"></i>
                                    Cédula del Propietario
                                </label>
                                <input type="text" id="cedulapropietario" name="cedulapropietario"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                    placeholder="Ej: 12345678">
                                <div class="error-message hidden text-red-500 text-sm mt-1"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Ubicación -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                            Ubicación
                        </h3>
                        
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Ubicación -->
                            <div class="form-group">
                                <label for="ubicacion" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-location-dot text-gray-400 mr-1"></i>
                                    Dirección/Ubicación
                                </label>
                                <input type="text" id="ubicacion" name="ubicacion"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                    placeholder="Ej: Vereda El Carmen, Municipio Ejemplo">
                            </div>

                            <!-- Coordenadas -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="form-group">
                                    <label for="latitud" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-compass text-gray-400 mr-1"></i>
                                        Latitud
                                    </label>
                                    <input type="number" id="latitud" name="latitud" step="any"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                        placeholder="Ej: 4.6097">
                                </div>

                                <div class="form-group">
                                    <label for="longitud" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-compass text-gray-400 mr-1"></i>
                                        Longitud
                                    </label>
                                    <input type="number" id="longitud" name="longitud" step="any"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                        placeholder="Ej: -74.0817">
                                </div>
                            </div>

                            <!-- Botón para obtener ubicación -->
                            <div class="flex justify-center">
                                <button type="button" id="getLocationBtn" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition duration-200 flex items-center">
                                    <i class="fas fa-crosshairs mr-2"></i>
                                    Obtener mi ubicación actual
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Características -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-seedling text-green-500 mr-2"></i>
                            Características de la Finca
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Hectáreas -->
                            <div class="form-group">
                                <label for="hectareas" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-ruler-combined text-gray-400 mr-1"></i>
                                    Hectáreas
                                </label>
                                <input type="number" id="hectareas" name="hectareas" min="0" step="0.1"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200"
                                    placeholder="Ej: 5.5">
                            </div>

                            <!-- Fuente de Agua -->
                            <div class="form-group">
                                <label for="fuenteagua" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-tint text-gray-400 mr-1"></i>
                                    Fuente de Agua
                                </label>
                                <select id="fuenteagua" name="fuenteagua"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200">
                                    <option value="">Seleccionar...</option>
                                    <option value="Río">Río</option>
                                    <option value="Quebrada">Quebrada</option>
                                    <option value="Pozo">Pozo</option>
                                    <option value="Acueducto">Acueducto</option>
                                    <option value="Aljibe">Aljibe</option>
                                    <option value="Lluvia">Lluvia</option>
                                    <option value="Ninguna">Ninguna</option>
                                </select>
                            </div>

                            <!-- Estado -->
                            <div class="form-group">
                                <label for="estado" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-check-circle text-gray-400 mr-1"></i>
                                    Estado
                                </label>
                                <select id="estado" name="estado"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200">
                                    <option value="Activa">Activa</option>
                                    <option value="Inactiva">Inactiva</option>
                                </select>
                            </div>
                        </div>

                        <!-- Explotación -->
                        <div class="mt-6">
                            <div class="form-group">
                                <label for="explotacion" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-leaf text-gray-400 mr-1"></i>
                                    Tipo de Explotación
                                </label>
                                <select id="explotacion" name="explotacion"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200">
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="Agricultura">Agricultura</option>
                                    <option value="Ganadería">Ganadería</option>
                                    <option value="Mixta">Mixta (Agricultura y Ganadería)</option>
                                    <option value="Avicultura">Avicultura</option>
                                    <option value="Porcicultura">Porcicultura</option>
                                    <option value="Acuicultura">Acuicultura</option>
                                    <option value="Forestal">Forestal</option>
                                    <option value="Turismo Rural">Turismo Rural</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-gray-200">
                        <button type="button" id="cancelBtn"
                            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200 flex items-center justify-center">
                            <i class="fas fa-times mr-2"></i>
                            Cancelar
                        </button>
                        
                        <button type="button" id="previewBtn"
                            class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200 flex items-center justify-center">
                            <i class="fas fa-eye mr-2"></i>
                            Vista Previa
                        </button>
                        
                        <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition duration-200 flex items-center justify-center shadow-lg">
                            <i class="fas fa-save mr-2"></i>
                            Crear Finca
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Modal de Vista Previa -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-eye text-blue-500 mr-2"></i>
                    Vista Previa de la Finca
                </h3>
            </div>
            <div id="previewContent" class="p-6">
                <!-- Content will be filled by JavaScript -->
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end">
                <button id="closePreviewBtn" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-200">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Finca creada exitosamente!</span>
        </div>
    </div>

    <script>
        // Obtener ubicación actual
        document.getElementById('getLocationBtn').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    document.getElementById('latitud').value = position.coords.latitude.toFixed(6);
                    document.getElementById('longitud').value = position.coords.longitude.toFixed(6);
                    showToast('Ubicación obtenida correctamente', 'success');
                }, function(error) {
                    showToast('Error al obtener la ubicación: ' + error.message, 'error');
                });
            } else {
                showToast('La geolocalización no está soportada en este navegador', 'error');
            }
        });

        // Vista previa
        document.getElementById('previewBtn').addEventListener('click', function() {
            const formData = new FormData(document.getElementById('fincaForm'));
            let previewHTML = '<div class="grid grid-cols-2 gap-4 text-sm">';
            
            const fieldLabels = {
                'nombre': 'Nombre',
                'cedulapropietario': 'Cédula Propietario',
                'ubicacion': 'Ubicación',
                'latitud': 'Latitud',
                'longitud': 'Longitud',
                'hectareas': 'Hectáreas',
                'fuenteagua': 'Fuente de Agua',
                'explotacion': 'Tipo de Explotación',
                'estado': 'Estado'
            };

            for (let [key, value] of formData.entries()) {
                if (value && fieldLabels[key]) {
                    previewHTML += `
                        <div>
                            <strong class="text-gray-600">${fieldLabels[key]}:</strong>
                            <span class="text-gray-800">${value}</span>
                        </div>
                    `;
                }
            }
            
            previewHTML += '</div>';
            
            if (previewHTML === '<div class="grid grid-cols-2 gap-4 text-sm"></div>') {
                previewHTML = '<p class="text-gray-500 text-center">No hay datos para mostrar</p>';
            }
            
            document.getElementById('previewContent').innerHTML = previewHTML;
            document.getElementById('previewModal').classList.remove('hidden');
        });

        // Cerrar modal de vista previa
        document.getElementById('closePreviewBtn').addEventListener('click', function() {
            document.getElementById('previewModal').classList.add('hidden');
        });

        // Cerrar modal al hacer clic fuera
        document.getElementById('previewModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // Validación del formulario
        document.getElementById('fincaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validación básica
            const nombre = document.getElementById('nombre').value.trim();
            if (!nombre) {
                showToast('El nombre de la finca es obligatorio', 'error');
                document.getElementById('nombre').focus();
                return;
            }

            // Aquí iría la lógica para enviar los datos al servidor
            // Por ejemplo, usando fetch() para enviar a Django
            
            // Simulación de éxito
            showToast('Finca creada exitosamente!', 'success');
            
            // Limpiar formulario después de 2 segundos
            setTimeout(() => {
                document.getElementById('fincaForm').reset();
            }, 2000);
        });

        // Cancelar formulario
        document.getElementById('cancelBtn').addEventListener('click', function() {
            if (confirm('¿Estás seguro de que quieres cancelar? Se perderán todos los datos ingresados.')) {
                document.getElementById('fincaForm').reset();
                showToast('Formulario cancelado', 'info');
            }
        });

        // Función para mostrar toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('successToast');
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500'
            };
            
            toast.className = `fixed top-4 right-4 text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 ${colors[type] || colors.info}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Mostrar toast
            toast.classList.remove('translate-x-full');
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // Animaciones de entrada para los campos del formulario
        const formGroups = document.querySelectorAll('.form-group');
        formGroups.forEach((group, index) => {
            group.style.opacity = '0';
            group.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                group.style.transition = 'all 0.5s ease-out';
                group.style.opacity = '1';
                group.style.transform = 'translateY(0)';
            }, index * 100);
        });
    </script> 
    {% endblock %}