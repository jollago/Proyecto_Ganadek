{% extends 'base.html' %}

{% block title %}Cambiar Contraseña - Ganadek{% endblock %}

{% block breadcrumb %}
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li><a href="{% url 'profile' %}" class="text-gray-600 hover:text-emerald-600 transition-colors">Mi Perfil</a></li>
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li class="text-emerald-600 font-medium">Cambiar Contraseña</li>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-emerald-50 via-white to-teal-50 py-8">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6 mb-8">
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-gradient-to-r from-emerald-600 to-teal-600 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-lock text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Cambiar Contraseña</h1>
                    <p class="text-gray-600">Actualiza tu contraseña para mantener tu cuenta segura</p>
                </div>
            </div>
        </div>

        <!-- Mensajes de éxito/error -->
        {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
            <div class="bg-{{ message.tags }}-50 border border-{{ message.tags }}-200 rounded-lg p-4 mb-4 flex items-center">
                <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-triangle{% else %}info-circle{% endif %} text-{{ message.tags }}-500 mr-3"></i>
                <span class="text-{{ message.tags }}-700">{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Formulario de Cambio de Contraseña -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6">
            <form method="POST" class="space-y-6">
                {% csrf_token %}
                
                <!-- Contraseña Actual -->
                <div>
                    <label for="{{ form.old_password.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-key mr-2 text-emerald-500"></i>
                        Contraseña Actual
                    </label>
                    <input type="password" 
                           name="{{ form.old_password.name }}" 
                           id="{{ form.old_password.id_for_label }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 {% if form.old_password.errors %}border-red-500{% endif %}"
                           placeholder="Ingresa tu contraseña actual"
                           required>
                    {% if form.old_password.errors %}
                        <div class="mt-2 text-sm text-red-600">
                            {% for error in form.old_password.errors %}
                                <p><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Nueva Contraseña -->
                <div>
                    <label for="{{ form.new_password1.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2 text-emerald-500"></i>
                        Nueva Contraseña
                    </label>
                    <input type="password" 
                           name="{{ form.new_password1.name }}" 
                           id="{{ form.new_password1.id_for_label }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 {% if form.new_password1.errors %}border-red-500{% endif %}"
                           placeholder="Ingresa tu nueva contraseña"
                           required>
                    {% if form.new_password1.errors %}
                        <div class="mt-2 text-sm text-red-600">
                            {% for error in form.new_password1.errors %}
                                <p><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Confirmar Nueva Contraseña -->
                <div>
                    <label for="{{ form.new_password2.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2 text-emerald-500"></i>
                        Confirmar Nueva Contraseña
                    </label>
                    <input type="password" 
                           name="{{ form.new_password2.name }}" 
                           id="{{ form.new_password2.id_for_label }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 {% if form.new_password2.errors %}border-red-500{% endif %}"
                           placeholder="Confirma tu nueva contraseña"
                           required>
                    {% if form.new_password2.errors %}
                        <div class="mt-2 text-sm text-red-600">
                            {% for error in form.new_password2.errors %}
                                <p><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Información de Seguridad -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-blue-800 mb-2">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Consejos de Seguridad
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>• Usa al menos 8 caracteres</li>
                        <li>• Incluye mayúsculas y minúsculas</li>
                        <li>• Añade números y símbolos</li>
                        <li>• Evita información personal</li>
                    </ul>
                </div>

                <!-- Botones -->
                <div class="flex justify-between pt-6">
                    <a href="{% url 'profile' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Volver al Perfil
                    </a>
                    <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-xl transition-colors">
                        <i class="fas fa-save mr-2"></i>Cambiar Contraseña
                    </button>
                </div>
            </form>
        </div>

        <!-- Información Adicional -->
        <div class="mt-8 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                <i class="fas fa-info-circle mr-2 text-emerald-500"></i>
                Información Importante
            </h3>
            <div class="space-y-3 text-sm text-gray-600">
                <p>• Al cambiar tu contraseña, permanecerás conectado en este dispositivo.</p>
                <p>• Se cerrará la sesión en otros dispositivos por seguridad.</p>
                <p>• Guarda tu nueva contraseña en un lugar seguro.</p>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript para mostrar/ocultar contraseña -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Función para alternar visibilidad de contraseña
    function togglePasswordVisibility(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);
        
        if (input.type === 'password') {
            input.type = 'text';
            toggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            input.type = 'password';
            toggle.innerHTML = '<i class="fas fa-eye"></i>';
        }
    }
    
    // Validación en tiempo real
    const newPassword1 = document.getElementById('{{ form.new_password1.id_for_label }}');
    const newPassword2 = document.getElementById('{{ form.new_password2.id_for_label }}');
    
    function validatePasswords() {
        if (newPassword1.value && newPassword2.value) {
            if (newPassword1.value === newPassword2.value) {
                newPassword2.classList.remove('border-red-500');
                newPassword2.classList.add('border-green-500');
            } else {
                newPassword2.classList.remove('border-green-500');
                newPassword2.classList.add('border-red-500');
            }
        }
    }
    
    if (newPassword1 && newPassword2) {
        newPassword1.addEventListener('input', validatePasswords);
        newPassword2.addEventListener('input', validatePasswords);
    }
});
</script>
{% endblock %}